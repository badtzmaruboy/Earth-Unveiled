<!DOCTYPE html>
<html>
<head>
<style>
    /* Set the background color and font color */
    body {
        background-color: #1a1a1a; /* Dark background */
        color: #b0e0e6; /* Cool light blue font */
        font-family: Arial, sans-serif;
    }

    /* Style for buttons */
    button {
        background-color: #1e90ff; /* Dodger blue */
        color: #ffffff;
        padding: 10px 20px;
        border: none;
        border-radius: 5px;
        cursor: pointer;
        font-size: 16px;
        margin: 5px;
    }

    /* Change button color on hover */
    button:hover {
        background-color: #4682b4; /* Steel blue */
    }

    /* Style for the input fields */
    input[type="text"] {
        padding: 8px;
        border: 1px solid #4682b4;
        border-radius: 5px;
        color: #b0e0e6;
        background-color: #333333;
        font-size: 16px;
        width: 200px;
        margin: 5px;
    }

    /* Style for the result text */
    #demo, #opposedResult, #probabilityResult, #exactProbabilityResult, #cumulativeProbabilityResult {
        margin-top: 20px;
        font-size: 18px;
        line-height: 1.5;
        color: #87cefa; /* Light sky blue */
    }
</style>
</head>

<body>

<h2>Dice Bot with +2 and Exploding Systems</h2>
<label for="diceInput1">Enter First Roll Command:</label>
<input type="text" id="diceInput1" placeholder="e.g., 7@6" />
<br><br>

<label for="diceInput2">Enter Second Roll Command (for Opposed Rolls):</label>
<input type="text" id="diceInput2" placeholder="e.g., 5@7" />
<br><br>

<label for="system">Choose System:</label>
<select id="system">
    <option value="exploding">Exploding</option>
    <option value="+2">+2 for 10s</option>
</select>
<br><br>

<button type="button" onclick="regularRoll()">
Roll the Dice</button>
<button type="button" onclick="printMultipleRolls(10)">
Roll 10 Times</button>
<button type="button" onclick="opposedRoll()">
Opposed Roll</button>
<button type="button" onclick="toggleExactProbability()">
Exact Outcome Probability (Bell Curve)</button>
<button type="button" onclick="toggleCumulativeProbability()">
Cumulative Probability (Land on at least X)</button>
<button type="button" onclick="toggleProbabilityForOpposed()">
Probability for Opposed Roll</button>

<p id="demo"></p>
<p id="opposedResult" style="display:none;"></p>
<p id="exactProbabilityResult" style="display:none;"></p>
<p id="cumulativeProbabilityResult" style="display:none;"></p>
<p id="probabilityResult" style="display:none;"></p>

<script>
// Function for regular roll (hides opposed result)
function regularRoll() {
    document.getElementById('opposedResult').style.display = "none";
    document.getElementById('demo').innerHTML = parseAndRoll(document.getElementById('diceInput1').value);
}

// Function to parse and roll based on the chosen system
function parseAndRoll(input) {
    let [dicePart, ...labelParts] = input.split(' ');
    let label = labelParts.join(' ') || "";
    let [numDiceStr, difficultyStr] = dicePart.split('@');
    
    let numDice = parseInt(numDiceStr) || 1;
    let difficulty = difficultyStr ? parseInt(difficultyStr) : 6;
    let exert = /ex/i.test(label);
    if (exert) label = label.replace(/ex/gi, "").trim();
    
    let diceReductionNote = "";
    if (difficulty > 9) {
        let excessDifficulty = difficulty - 9;
        numDice = Math.max(1, numDice - excessDifficulty);
        diceReductionNote = ` (Challenge set to 9 with -${excessDifficulty} Dice)`;
        difficulty = 9;
    }

    // Choose system based on dropdown selection
    let system = document.getElementById("system").value;
    if (system === "exploding") {
        return rollDiceExploding(numDice, difficulty, exert, label, diceReductionNote);
    } else {
        return rollDicePlusTwo(numDice, difficulty, exert, label, diceReductionNote);
    }
}

// Function to roll multiple sets of dice
function printMultipleRolls(times) {
    document.getElementById('opposedResult').style.display = "none"; // Hide opposed result
    let input = document.getElementById('diceInput1').value;
    let results = [];
    for (let i = 0; i < times; i++) {
        results.push(parseAndRoll(input));
    }
    document.getElementById('demo').innerHTML = results.join("<br><br>");
}

// Opposed Roll function with two different inputs
function opposedRoll() {
    const input1 = document.getElementById('diceInput1').value;
    const input2 = document.getElementById('diceInput2').value;
    let roll1 = parseAndRoll(input1);
    let roll2 = parseAndRoll(input2);

    // Extract results from each roll
    let result1 = parseInt(roll1.match(/Result: (-?\d+)/)[1]);
    let result2 = parseInt(roll2.match(/Result: (-?\d+)/)[1]);
    let opposedResult = result1 - result2;

    // Display both rolls and the opposed result
    document.getElementById('opposedResult').innerHTML = `
        <strong>First Roll:</strong> ${roll1} <br>
        <strong>Second Roll:</strong> ${roll2} <br>
        <strong>Opposed Result:</strong> ${result1} - ${result2} = ${opposedResult}
    `;
    document.getElementById('opposedResult').style.display = "block";
}

// Toggle display of Exact Probability
function toggleExactProbability() {
    const probabilityElement = document.getElementById("exactProbabilityResult");
    document.getElementById('opposedResult').style.display = "none"; // Hide opposed result
    if (probabilityElement.style.display === "none") {
        calculateExactProbability();
        probabilityElement.style.display = "block";
    } else {
        probabilityElement.style.display = "none";
    }
}

// Toggle display of Cumulative Probability
function toggleCumulativeProbability() {
    const probabilityElement = document.getElementById("cumulativeProbabilityResult");
    document.getElementById('opposedResult').style.display = "none"; // Hide opposed result
    if (probabilityElement.style.display === "none") {
        calculateCumulativeProbability();
        probabilityElement.style.display = "block";
    } else {
        probabilityElement.style.display = "none";
    }
}

// Toggle probability for opposed roll
function toggleProbabilityForOpposed() {
    const probabilityElement = document.getElementById("probabilityResult");
    const input1 = document.getElementById('diceInput1').value;
    const input2 = document.getElementById('diceInput2').value;

    if (probabilityElement.style.display === "none") {
        calculateProbabilityForOpposed(input1, input2);
        probabilityElement.style.display = "block";
    } else {
        probabilityElement.style.display = "none";
    }
}

// Function to simulate probability for opposed roll
function calculateProbabilityForOpposed(input1, input2) {
    const trials = 10000;
    let winA = 0;
    let winB = 0;
    let draws = 0;
    let winMarginA = {};
    let winMarginB = {};

    for (let i = 0; i < trials; i++) {
        let result1 = parseInt(parseAndRoll(input1).match(/Result: (-?\d+)/)[1]);
        let result2 = parseInt(parseAndRoll(input2).match(/Result: (-?\d+)/)[1]);
        let margin = Math.abs(result1 - result2);

        if (result1 > result2) {
            winA++;
            winMarginA[margin] = (winMarginA[margin] || 0) + 1;
        } else if (result1 < result2) {
            winB++;
            winMarginB[margin] = (winMarginB[margin] || 0) + 1;
        } else {
            draws++;
        }
    }

    const winAProb = ((winA / trials) * 100).toFixed(2);
    const winBProb = ((winB / trials) * 100).toFixed(2);
    const drawProb = ((draws / trials) * 100).toFixed(2);

    let result = `<strong>Probability of Opposed Results:</strong><br>`;
    result += `Roll A wins: ${winAProb}% <br>`;
    result += `Roll B wins: ${winBProb}% <br>`;
    result += `Draws: ${drawProb}% <br><br>`;

    result += `<strong>Win Margin Distribution for Roll A:</strong><br>`;
    for (let margin in winMarginA) {
        let percentage = ((winMarginA[margin] / winA) * 100).toFixed(2);
        result += `Margin ${margin}: ${percentage}%<br>`;
    }

    result += `<br><strong>Win Margin Distribution for Roll B:</strong><br>`;
    for (let margin in winMarginB) {
        let percentage = ((winMarginB[margin] / winB) * 100).toFixed(2);
        result += `Margin ${margin}: ${percentage}%<br>`;
    }

    document.getElementById("probabilityResult").innerHTML = result;
}

// Exploding system: roll dice with exploding 10s
function rollDiceExploding(numDice, floor, exert, label, diceReductionNote) {
    let results = [];
    let tally = 0;

    for (let i = 0; i < numDice; i++) {
        let roll = Math.floor(Math.random() * 10) + 1;
        let rollDisplay = roll;

        if (roll >= floor && roll < 10) {
            tally += 1;
        } else if (roll === 10) {
            tally += 1;
            let extraRoll = Math.floor(Math.random() * 10) + 1;
            rollDisplay += `(${extraRoll})`; // Show single explosion
            if (extraRoll >= floor) {
                tally += 1;
            }
        } else if (roll === 1) {
            tally -= 1;
        }
        results.push(rollDisplay);
    }

    if (exert) {
        tally += 1;
        label += " (Exerted)";
    }

    return `${label ? label : ''} [Dice Results: ${results.join(", ")}] <br> Challenge: ${floor}${diceReductionNote} <br> Result: ${tally}`;
}

// +2 system: each roll of 10 adds +2 directly
function rollDicePlusTwo(numDice, floor, exert, label, diceReductionNote) {
    let results = [];
    let tally = 0;

    for (let i = 0; i < numDice; i++) {
        let roll = Math.floor(Math.random() * 10) + 1;
        let rollDisplay = roll;

        if (roll >= floor && roll < 10) {
            tally += 1;
        } else if (roll === 10) {
            tally += 2; // Each 10 adds +2 in the +2 system
        } else if (roll === 1) {
            tally -= 1;
        }
        results.push(rollDisplay);
    }

    if (exert) {
        tally += 1;
        label += " (Exerted)";
    }

    return `${label ? label : ''} [Dice Results: ${results.join(", ")}] <br> Challenge: ${floor}${diceReductionNote} <br> Result: ${tally}`;
}
</script>

</body>
</html>
